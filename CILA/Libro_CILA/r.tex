%Autor: miguev

\chapter{R}

   {\tt R}  es un  entorno de  programación para  análisis de
datos y gráficos, especialmente  útil para estadística. {\tt R} dispone
de librerías  que implementan muchas técnicas  estadísticas, desde las
clásicas  hasta la  última  metodología, pero  el  usuario debe  estar
dispuesto a trabajar un poco para encontrarlas. 

 La forma  de trabajar con {\tt R} es distinta  a la de otros
programas  como  {\tt SPSS}.  En  {\tt R}, un  análisis  estadístico  se
realiza en  una serie  de pasos, con  unos resultados  intermedios que
se  van  almacenando en  objetos,  para  ser observados  o  analizados
posteriormente,  produciendo  unas  salidas  mínimas.  En  {\tt SPSS}
se  obtendría de  modo  inmediato una  salida  copiosa para  cualquier
análisis. Esto puede parecer a primera vista una terrible incomodidad,
pero  si  tuviéramos   que  trabajar  en  una   máquina  poco  potente
rápidamente nos daríamos cuenta de que puede resultar muy ventajosa la
sencillez  del  entorno  de  {\tt R}  (un entorno  de  comandos)  y  la
posibilidad de ver en cada momento exactamente lo que se necesita, sin
excesos que desperdicien recursos del sistema. 

 Veamos  cómo se trabaja  con {\tt R} usándolo. En  primer lugar
conviene crear  un directorio  y entrar  en él  antes de  comenzar una
sesión con {\tt R}, que en éste almacena siempre en el directorio donde
se ejecutan unos ficheros donde almacena los objetos, datos, funciones
y comandos ejecutados. Esto puede  sernos muy útil en trabajos largos,
podemos  interrumpir  la sesión  con  {\tt R}  en cualquier  momento  y
recuperarla luego donde mismo la dejamos. 

 Hemos considerado a lo largo  de este curso que el símbolo del
sistema  Linux/UNIX es  {\tt \$},  y  ahora vamos  a  considerar que  el
símbolo del prompt {\tt R} es {\tt $>$}. Abrimos un emulador de terminal
dentro del entorno gráfico y seguimos los siguientes pasos. 

\begin{verbatim}
$ mkdir sesion_R
$ cd sesion_R
$ R

R : Copyright 1999, The R Development Core Team
Version 0.90.1  (December 15, 1999)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type	"?license" or "?licence" for distribution details.

R is a collaborative project with many contributors.
Type	"?contributors" for a list.

Type	"demo()" for some demos, "help()" for on-line help, or
     	"help.start()" for a HTML browser interface to help.
Type	"q()" to quit R.

>
\end{verbatim}

 El símbolo  {\tt $>$} es el prompt de {\tt R},  indica que está
esperando  nuestras  órdenes  para ejecutarlas.  Comenzamos  con  unos
ejemplos de vectores, distribuciones  probabilísticas y algún gráfico.


\begin{verbatim}
> x <- rnorm(50)
> y <- rnorm(x)
> plot(x,y)
> ls()
[1] "x"        "y"
> rm(x,y)
\end{verbatim}

 Hasta ahora nada complicado,  hemos introducido en {\tt x} y en
{\tt y} dos vectores  cada uno de 50 pseudoaleatorios  obtenidos de una
distribución normal  N(0,1), los mostrados  en un gráfico  X-Y, listado
los  objetos  disponibles y  borrados  los  objetos {\tt x}  e  {\tt y}.


\begin{verbatim}
> x <- 1:20
> w <- 1 + sqrt(x)/2
> hoja.de.datos <- data.frame(x=x,y=x+rnorm(x)*w)
> hoja.de.datos
> regr <- lm(y~x,data=hoja)
> summary(regr)

Call:
lm(formula = y ~ x, data = hoja)

Residuals:
    Min      1Q  Median      3Q     Max 
    -4.4338 -1.6785 -0.4704  1.9643  4.1038 

    Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.78985    1.08627   1.648    0.117    
x            0.84553    0.09068   9.324 2.59e-08 ***
---
Signif. codes:  0  `***'  0.001  `**'  0.01  `*'  0.05  `.'  0.1  ` '  1 

Residual standard error: 2.338 on 18 degrees of freedom
Multiple R-Squared: 0.8285,	Adjusted R-squared: 0.8189 
F-statistic: 86.94 on 1 and 18 degrees of freedom,	p-value: 2.592e-08 
\end{verbatim}

 Esta vez hemos introducido  en {\tt x} el vector (1,2,...,20) y
a partir  de él creamos  un vector pon\-de\-ra\-do de  desviaciones típicas,
que  almacenamos  en  {\tt w}.  Con  estos  dos  vectores  creamos  una
{\em hoja  de datos},  la guardamos  en {\tt hoja},  y la  mostramos por
pantalla.  A  continuación  realizamos  el  ajuste  de  un  modelo  de
regresión lineal de {\tt y} sobre {\tt x}, lo almacenamos en {\tt regr} y
presentamos en pantalla un resumen  del análisis. Veamos ahora algunas
representaciones gráficas a partir de estos datos. 

 En primer  lugar conectamos la hoja de datos,  de tal modo que
sus  columnas  aparecen  como  variables y  podemos  acceder  a  ellas
directamente  por  su  nombre.   Realizamos  una  regresión  local  no
paramétrica.  Representamos el  gráfico  bidimensional  estándar y  le
superponemos la regresión local, la verdadera recta de regresión, y la
recta de regresión ponderada. Una vez  que hemos terminado con la hoja
de datos {\tt hoja} la desconectamos. 

\begin{verbatim}
> attach(hoja)
> regr.loc <- lowess(x,y)
> plot(x,y)
> lines(x,regr.loc$y)
> abline(0,1,lty=3)
> abline(coef(regr),col="red")
> detach()
\end{verbatim}

  Finalmente  terminamos la  sesión  con  el comando  {\tt q()}.
{\tt R} nos  preguntará si  queremos guardar la  imagen del  espacio de
trabajo, que es donde están  guardados todos los objetos que estábamos
usando y  el historial  de los comandos  que hemos  ejecutado. Podemos
responder {\tt c}  para cancelar y  no salir, {\tt n} para  desechar los
datos y no guardarlos  o {\tt y} para guardar los datos  de la sesión y
poder así retomarla en cualquier momento. Nótese que {\tt R} guarda una
imagen de espacio  de trabajo en cada directorio donde  se ejecuta, lo
que  nos permite  tener múltiples  sesiones guardadas  según dónde  lo
hayamos ejecutado. 



